<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unit Circle Snake Game</title>
  <!-- KaTeX CSS for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; background: #f2f2f2; }
    /* Container for the game view */
    #game-container {
      position: relative;
      width: 640px;
      height: 480px;
      margin: 20px auto;
      background: #fff;
      border: 2px solid #333;
      overflow: hidden;
    }
    /* Canvas for drawing snake (no grid) */
    canvas {
      position: absolute;
      top: 80px;
      left: 0;
    }
    /* The question div at the top */
    #question {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background: #eee;
      border-bottom: 2px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    /* Lives indicator: top right */
    #lives {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      color: red;
    }
    /* Score indicator: top left */
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 24px;
      color: #333;
    }
    /* Game Over overlay */
    #gameOver {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      z-index: 10;
    }
    /* Food elements are absolutely positioned divs */
    .food {
      position: absolute;
      width: 20px;
      height: 20px;
      pointer-events: none;
    }
    /* Main menu styling: a sexier homepage */
    #menu {
      width: 640px;
      height: 480px;
      margin: 20px auto;
      background: linear-gradient(135deg, #6e8efb, #a777e3);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    #menu h1 { font-size: 36px; margin-bottom: 10px; }
    #welcome { margin: 20px; font-size: 16px; }
    .button {
      margin: 10px;
      padding: 10px 20px;
      background: rgba(255,255,255,0.8);
      color: #333;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 18px;
      transition: background 0.3s;
    }
    .button:hover {
      background: rgba(255,255,255,1);
    }
    /* Settings screen styling */
    #settings {
      width: 640px;
      height: 480px;
      margin: 20px auto;
      background: #f2f2f2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .checkbox { margin: 5px; }
  </style>
</head>
<body>
  <!-- Main Menu -->
  <div id="menu">
    <h1>Unit Circle Snake Game</h1>
    <p id="welcome">
      Welcome to my Unit Circle Snake Game! It plays like a normal snake game, except you can only grow by eating the correct answer to the question at the top of the screen. You have three wrong mistakes before the game is over! Use the settings to control which functions and quadrants are included. I hope this is helpful!
    </p>
    <button id="playButton" class="button">Play</button>
    <button id="settingsButton" class="button">Settings</button>
  </div>
  <!-- Settings Screen -->
  <div id="settings" style="display:none;">
    <h1>Settings</h1>
    <div>
      <label class="checkbox"><input type="checkbox" id="sinCheckbox" checked> sin</label>
      <label class="checkbox"><input type="checkbox" id="cosCheckbox" checked> cos</label>
      <label class="checkbox"><input type="checkbox" id="tanCheckbox" checked> tan</label>
    </div>
    <div>
      <label class="checkbox"><input type="checkbox" id="quad1" checked> Quadrant 1</label>
      <label class="checkbox"><input type="checkbox" id="quad2" checked> Quadrant 2</label>
      <label class="checkbox"><input type="checkbox" id="quad3" checked> Quadrant 3</label>
      <label class="checkbox"><input type="checkbox" id="quad4" checked> Quadrant 4</label>
    </div>
    <button id="backButton" class="button">Back</button>
  </div>
  <!-- Game View -->
  <div id="game-container" style="display:none;">
    <div id="question"></div>
    <div id="lives"></div>
    <div id="score"></div>
    <canvas id="gameCanvas" width="640" height="400"></canvas>
    <div id="gameOver"></div>
  </div>

  <!-- Load KaTeX -->
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"></script>
  <script>
    // Global variables and constants
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const questionDiv = document.getElementById("question");
    const livesDiv = document.getElementById("lives");
    const scoreDiv = document.getElementById("score");
    const gameOverDiv = document.getElementById("gameOver");
    const gameContainer = document.getElementById("game-container");
    const menuDiv = document.getElementById("menu");
    const settingsDiv = document.getElementById("settings");

    const CELL_SIZE = 20;
    const GRID_WIDTH = 640 / CELL_SIZE;
    const GRID_HEIGHT = 400 / CELL_SIZE; // canvas height is 400

    let gameInterval;
    let gameState = "menu"; // "menu", "settings", "playing"

    // Settings for functions and quadrants
    let settings = {
      functions: { sin: true, cos: true, tan: true },
      quadrants: { 1: true, 2: true, 3: true, 4: true }
    };

    // Game state variables
    let snake;
    let direction;
    let foods;
    let currentQuestion;
    let correctAnswer;
    let lives;
    let score;
    let foodElements = [];  // HTML elements for foods

    // Base values for each function (La
